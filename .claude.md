# Claude Code Rules for DataBridge

## Documentation Guidelines
- always if new features are needed, update FEATURES.md
- always if changes are made to the code, update CHANGELOG.md
- always if changes are made to the UI, update README.md
- always if changes are made to the API, update API.md
- always if changes are made to the configuration, update CONFIGURATION.md
- always if changes are made to the environment, update ENVIRONMENT.md
- always if changes are made to the logging, update LOGGING.md

### ❌ Do NOT Create These Files
- **README files** - Unless explicitly requested
- **Migration guides** (e.g., `MIGRATION.md`, `UPGRADE.md`)
- **How-to guides** (e.g., `HOW_TO_*.md`)
- **Tutorial files** (e.g., `TUTORIAL.md`, `GETTING_STARTED.md`)
- **Changelog files per feature** - Use main CHANGELOG.md instead

### ✅ Instead, Use CHANGELOG.md
When making changes, updates, or fixes:
1. Add entries to `CHANGELOG.md` in the project root
2. Use semantic versioning format
3. Group by type: Added, Changed, Fixed, Removed, Deprecated
4. Be concise but descriptive

**Example CHANGELOG entry:**
```markdown
## [Unreleased]

### Added
- Tailwind CSS v4 support with `@theme` configuration
- PageLayout, PageHeader, PageContainer components for consistent UI

### Changed
- Migrated from Tailwind CSS v3 to v4 syntax (`@import` instead of `@tailwind`)
- Updated Makefile `dev` command to check dependencies before starting

### Fixed
- CSS styles not loading due to Tailwind v4 configuration mismatch
- Layout alignment issues with sidebar and content area
```

## Code Style & Patterns
- build using test driven development
- use the latest version of the libraries and frameworks
- use the latest version of the tools and utilities
- use the latest version of the languages
- use the latest version of the operating systems
- use the latest version of the browsers
- use the latest version of the devices


### Frontend (TypeScript/React)
- Use `'use client'` directive for client components
- Prefer function components over class components
- Use TypeScript for all new code
- Export types alongside components
- Use barrel exports (`index.ts`) for component folders
- Follow existing naming conventions:
  - Components: PascalCase (e.g., `PageLayout.tsx`)
  - Hooks: camelCase with `use` prefix (e.g., `useMonitoring.ts`)
  - Utils: camelCase (e.g., `formatBytes.ts`)

### Backend (Go)
- Follow standard Go conventions
- Use receiver names: single letter (e.g., `h *Handler`)
- Add comments for exported functions
- Use structured logging with logrus
- Error handling: return errors, don't panic

### CSS (Tailwind v4)
- Use `@import "tailwindcss"` not `@tailwind` directives
- Configure theme in `@theme {}` blocks, not JS config
- Use semantic color names
- Prefer utility classes over custom CSS
- Mobile-first responsive design

## Git & Commits

### Commit Messages
- Use conventional commits format: `type(scope): message`
- Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`
- Keep first line under 72 characters
- Add body for complex changes

**Examples:**
```
feat(ui): add PageLayout component system
fix(makefile): ensure npm deps installed before dev start
refactor(css): migrate to Tailwind CSS v4 configuration
```

## File Organization

### Do NOT Create
- Multiple README files in subdirectories
- Duplicate documentation
- "Archive" or "backup" folders in git
- Test files in production code directories (use separate test dirs)

### Preferred Structure
```
databridge/
├── CHANGELOG.md          # All changes go here
├── README.md             # Main project README only
├── QUICK_START.md        # If needed, single getting started guide
├── cmd/                  # Go binaries
├── internal/             # Go packages
├── frontend/             # React app
│   ├── app/             # Next.js pages
│   ├── components/      # Reusable components
│   │   └── layout/      # With index.ts barrel export
│   └── hooks/           # Custom React hooks
└── plugins/             # Processor plugins
```

## Development Workflow

### Before Committing
- Run linters: `make lint` (backend), `make frontend-lint`
- Run tests: `make test`
- Format code: `make fmt`
- Update CHANGELOG.md with changes

### Starting Fresh
- Use `make dev-fresh` to clear cache and start clean
- Use `make dev` for daily development

### Testing Changes
1. Test locally with `make dev`
2. Check browser console for errors (F12)
3. Test on multiple screen sizes
4. Verify backend API responses

## UI/UX Guidelines

### Layout
- Use `PageLayout` component for standard pages
- Maintain consistent spacing (4, 6, 8 unit scale)
- Keep sidebar navigation visible on desktop
- Ensure mobile responsiveness

### Colors
- Primary: Blue (#3b82f6)
- Success: Green (#16a34a)
- Warning: Yellow (#ca8a04)
- Error: Red (#dc2626)
- Neutrals: Gray scale

### Typography
- Headings: Bold, size scale (3xl, 2xl, xl, lg)
- Body: Regular, text-sm or text-base
- Code: Monospace font family

## Testing

### Required Tests
- Unit tests for critical paths
- Integration tests for API endpoints
- Component tests for complex UI
- E2E tests for user flows (when available)

### Test Coverage Goals
- Backend: 75%+ line coverage
- Frontend: 80%+ component coverage
- Critical paths: 100% coverage

## Performance

### Frontend
- Lazy load routes and components
- Optimize images (use Next.js Image)
- Minimize bundle size
- Use React.memo for expensive components
- Debounce/throttle event handlers

### Backend
- Use goroutine pools, not unbounded goroutines
- Implement timeouts on all external calls
- Use connection pooling
- Cache frequently accessed data
- Profile before optimizing

## Security

### Never Commit
- API keys or secrets
- Environment files (`.env`) with real values
- Credentials or passwords
- Private keys or certificates

### Always
- Validate all user inputs
- Sanitize data before database queries
- Use parameterized queries
- Implement rate limiting
- Follow principle of least privilege

## Error Handling

### Frontend
```tsx
try {
  // operation
} catch (error) {
  console.error('Operation failed:', error);
  // Show user-friendly error message
}
```

### Backend
```go
if err != nil {
    return fmt.Errorf("operation failed: %w", err)
}
```

## Questions Before Implementing

1. **Is this feature requested?** Don't add features proactively
2. **Does this belong in CHANGELOG?** Yes, almost always
3. **Do we need a new file?** Probably not - use existing files
4. **Is this documented elsewhere?** Check before duplicating
5. **Will this break existing code?** Test thoroughly

## Communication

### When Explaining Code
- Be concise and direct
- Focus on "what" and "why", not "how"
- Link to relevant documentation
- Provide examples for complex concepts

### When Reporting Issues
- Include error messages
- Specify file and line numbers
- Describe expected vs actual behavior
- Provide reproduction steps

## Tools & Commands

### Frequently Used
```bash
make dev          # Start full stack
make dev-fresh    # Fresh start (clear cache)
make test         # Run all tests
make lint         # Lint backend
make frontend-lint # Lint frontend
make build        # Build backend
make help         # Show all commands
```

### Debugging
```bash
make run-debug    # Backend with race detection
npm run dev       # Frontend with hot reload
```

## Version Control

### Branch Naming
- Feature: `feature/description`
- Fix: `fix/description`
- Refactor: `refactor/description`
- Release: `release/v1.2.3`

### Pull Requests
- Keep focused on single feature/fix
- Update CHANGELOG.md
- Link related issues
- Request review from team

## AI Assistant Guidelines

### You Should
- Update CHANGELOG.md for all changes
- Ask before creating new documentation files
- Follow existing code patterns and structure
- Run tests before considering work complete
- Be direct and concise in responses

### You Should NOT
- Create documentation files without being asked
- Add features not explicitly requested
- Modify working code without reason
- Skip error handling
- Ignore existing conventions

---

**Last Updated:** 2025-01-03
**Version:** 1.0.0
